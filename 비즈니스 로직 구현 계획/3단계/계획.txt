===== 3단계: 분산 트랜잭션 + 데이터 동기화 + AWS 배포 =====

목표: 서버간 정합성 해결 + 상품 데이터 동기화 + 실환경 배포

======================================================================
  3-1. 분산 트랜잭션 해결
======================================================================

  [문제]
  서버1에서 챌린지 완료 → 서버2에서 주문 성공 → 서버1에서 저장 실패
  → 주문은 됐는데 완료 기록이 없음

  [해결: Saga 패턴 (보상 트랜잭션)]
  정상 흐름:
    서버1: 챌린지 완료 처리
    서버2: 주문 생성 (POST /api/orders)
    서버1: 완료 이력 저장

  실패 시 보상:
    서버1: 완료 이력 저장 실패
    서버2: 주문 취소 요청 (PATCH /api/orders/:id/status → CANCELLED)
    서버1: 챌린지 상태 롤백

  [구현]
  - 서버1: 보상 트랜잭션 로직 (try-catch에서 실패 시 서버2 취소 호출)
  - 서버2: 주문 취소 API + 재고 복구 로직
  - 실패 케이스 테스트 (의도적 예외 주입)

======================================================================
  3-2. 상품 데이터 동기화
======================================================================

  [문제]
  서버2에서 상품 가격/재고/상태가 변경되면 서버1은 모름
  → 품절인데 챌린지 보상으로 걸려있음, 가격 변경됐는데 옛날 정보 표시

  [해결 방안 비교 실습]

  방법1: 실시간 API 조회
    - 서버1이 상품 정보 필요할 때마다 서버2 API 호출
    - 장점: 항상 최신
    - 단점: 서버2 장애 시 서버1도 영향

  방법2: 캐싱 + TTL
    - 서버1이 Redis에 상품 정보 캐싱 (TTL: 5분)
    - 장점: 빠름, 서버2 장애 내성
    - 단점: TTL 동안 불일치 가능

  방법3: 이벤트 기반 동기화
    - 서버2가 상품 변경 시 Webhook으로 서버1에 알림
    - 또는 Redis Pub/Sub로 변경 이벤트 발행
    - 장점: 거의 실시간
    - 단점: 구현 복잡도

  [구현]
  - 3가지 방법 모두 구현해서 스위칭 가능하게
  - 각 방법의 불일치 구간 측정

======================================================================
  3-3. AWS 배포
======================================================================

  [인프라 구성]
  - EC2 인스턴스 (t3.medium 이상)
  - Docker Compose로 전체 시스템 배포:
    - concurrency-lab (Spring Boot)
    - shop-api (NestJS)
    - devquest-web (Nginx로 정적 파일 서빙)
    - PostgreSQL x2
    - Redis

  [배포 흐름]
  1. EC2 인스턴스 생성 + Docker/Docker Compose 설치
  2. GitHub에서 코드 pull
  3. docker-compose up -d 로 전체 기동
  4. Security Group에서 80, 8080, 3000 포트 오픈

  [실환경 테스트]
  - 네트워크 지연이 있는 상태에서 동시성 테스트
  - 로컬보다 문제가 더 잘 재현됨 (네트워크 latency)

======================================================================
  3단계 완료 기준
======================================================================

  - Saga 패턴으로 분산 트랜잭션 해결
  - 상품 데이터 동기화 3가지 방법 비교
  - AWS에 전체 시스템 배포 완료
  - 실환경에서 동시성/정합성 테스트 통과
