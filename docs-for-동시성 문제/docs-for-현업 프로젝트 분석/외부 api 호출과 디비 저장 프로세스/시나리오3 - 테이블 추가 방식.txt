================================================================================
  ì‹œë‚˜ë¦¬ì˜¤ 3: í…Œì´ë¸” ì¶”ê°€ ë°©ì‹ (ë³„ë„ sync_log í…Œì´ë¸”)
================================================================================

  ë‚œì´ë„: â˜…â˜…â˜…â˜…â˜† (ì¤‘ìƒ)
  ìŠ¤í‚¤ë§ˆ ë³€ê²½: CREATE TABLE (sync_log í…Œì´ë¸” ì‹ ê·œ ìƒì„±)
  ì¶”ê°€ ê°œë°œ: ë¡œê·¸ ê¸°ë¡ + ì¬ì‹œë„ ë¡œì§ + ìŠ¤ì¼€ì¤„ëŸ¬ + ê´€ë¦¬ í™”ë©´

================================================================================
  1. ê°œìš”
================================================================================

  ë¹„ì¦ˆë‹ˆìŠ¤ í…Œì´ë¸”ì€ ê±´ë“œë¦¬ì§€ ì•Šê³ , ë³„ë„ì˜ ë™ê¸°í™” ë¡œê·¸ í…Œì´ë¸”ì„ ìƒì„±í•˜ì—¬
  ëª¨ë“  ì™¸ë¶€ API í˜¸ì¶œì˜ ìš”ì²­/ì‘ë‹µ ì´ë ¥ì„ ìƒì„¸íˆ ê¸°ë¡í•˜ëŠ” ë°©ì‹.

  í•µì‹¬ ì•„ì´ë””ì–´:
  - ë¹„ì¦ˆë‹ˆìŠ¤ í…Œì´ë¸”(bs_airstar_brand)ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
  - ë³„ë„ sync_log í…Œì´ë¸”ì— API í˜¸ì¶œ ì´ë ¥ ê¸°ë¡
  - ìš”ì²­ ë³¸ë¬¸, ì‘ë‹µ ì½”ë“œ, ì—ëŸ¬ ë©”ì‹œì§€, ì¬ì‹œë„ íšŸìˆ˜ ë“± ìƒì„¸ ì¶”ì 
  - ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ìë™ ì¬ì‹œë„ + ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ê´€ë¦¬
  - ê´€ë¦¬ í™”ë©´ì—ì„œ ì „ì²´ ë™ê¸°í™” ì´ë ¥ ì¡°íšŒ ê°€ëŠ¥

  í•µì‹¬ ì°¨ì´ (ì‹œë‚˜ë¦¬ì˜¤ 2ì™€ ë¹„êµ):
  - ì‹œë‚˜ë¦¬ì˜¤ 2: ë¹„ì¦ˆë‹ˆìŠ¤ í…Œì´ë¸”ì— sync_status ì»¬ëŸ¼ 1ê°œ ì¶”ê°€ (ê°„ë‹¨)
  - ì‹œë‚˜ë¦¬ì˜¤ 3: ë³„ë„ í…Œì´ë¸”ì— ìƒì„¸ ì´ë ¥ ê´€ë¦¬ (ì²´ê³„ì )

  â€» ì£¼ì˜: Kafka, Redis ê°™ì€ ë©”ì‹œì§• ì¸í”„ë¼ í•„ìš” ì—†ìŒ
     ì¼ë°˜ RDB í…Œì´ë¸” + @Scheduled ë§Œìœ¼ë¡œ ì¶©ë¶„

================================================================================
  2. DDL (í…Œì´ë¸” ì„¤ê³„)
================================================================================

  CREATE TABLE fscps.bs_api_sync_log (
      sync_id         BIGSERIAL       PRIMARY KEY,
      -- ëŒ€ìƒ ì‹ë³„
      target_table    VARCHAR(50)     NOT NULL,       -- 'bs_airstar_brand'
      target_id       VARCHAR(100)    NOT NULL,       -- ëŒ€ìƒ ë ˆì½”ë“œ PK (ste_id ë“±)
      -- API ì •ë³´
      interface_id    VARCHAR(10)     NOT NULL,       -- 'CP204', 'CP206' ë“±
      api_method      VARCHAR(10),                    -- 'POST', 'PUT'
      -- ìš”ì²­/ì‘ë‹µ
      request_body    TEXT,                           -- JSON ìš”ì²­ ë³¸ë¬¸
      response_code   VARCHAR(10),                    -- '0200', '0500' ë“±
      response_body   TEXT,                           -- JSON ì‘ë‹µ ë³¸ë¬¸
      error_message   VARCHAR(500),                   -- ì˜ˆì™¸ ë©”ì‹œì§€
      -- ìƒíƒœ ê´€ë¦¬
      sync_status     VARCHAR(10)     NOT NULL        -- PENDING/SUCCESS/FAIL/DEAD
                      DEFAULT 'PENDING',
      retry_count     INT             DEFAULT 0,      -- ì¬ì‹œë„ íšŸìˆ˜
      max_retry       INT             DEFAULT 3,      -- ìµœëŒ€ ì¬ì‹œë„
      -- ì‹œê°„
      created_at      TIMESTAMP       DEFAULT NOW(),  -- ìµœì´ˆ ìƒì„±
      updated_at      TIMESTAMP       DEFAULT NOW(),  -- ìµœì¢… ìˆ˜ì •
      next_retry_at   TIMESTAMP,                      -- ë‹¤ìŒ ì¬ì‹œë„ ì˜ˆì • ì‹œê°
      -- ì‘ì„±ì
      created_by      VARCHAR(50)                     -- ìš”ì²­í•œ ì‚¬ìš©ì ID
  );

  -- ì¸ë±ìŠ¤
  CREATE INDEX idx_sync_log_status ON fscps.bs_api_sync_log(sync_status);
  CREATE INDEX idx_sync_log_target ON fscps.bs_api_sync_log(target_table, target_id);
  CREATE INDEX idx_sync_log_retry  ON fscps.bs_api_sync_log(sync_status, next_retry_at);

  -- ì½”ë©˜íŠ¸
  COMMENT ON TABLE fscps.bs_api_sync_log
  IS 'ì™¸ë¶€ API ë™ê¸°í™” ì´ë ¥ ë° ì¬ì‹œë„ ê´€ë¦¬ í…Œì´ë¸”';

  COMMENT ON COLUMN fscps.bs_api_sync_log.sync_status
  IS 'PENDING: ëŒ€ê¸°, SUCCESS: ì„±ê³µ, FAIL: ì‹¤íŒ¨(ì¬ì‹œë„ ëŒ€ìƒ), DEAD: ì¬ì‹œë„ í¬ê¸°';

  -- ìƒíƒœê°’ ì •ì˜:
  -- PENDING : ìƒì„±ë¨, API ì•„ì§ ë¯¸í˜¸ì¶œ
  -- SUCCESS : API í˜¸ì¶œ ì„±ê³µ
  -- FAIL    : API í˜¸ì¶œ ì‹¤íŒ¨ (ì¬ì‹œë„ ëŒ€ìƒ, retry_count < max_retry)
  -- DEAD    : ì¬ì‹œë„ ìµœëŒ€ íšŸìˆ˜ ì´ˆê³¼ (ê´€ë¦¬ì ìˆ˜ë™ í™•ì¸ í•„ìš”)

================================================================================
  3. êµ¬í˜„ ì½”ë“œ
================================================================================

--------------------------------------------------------------------------------
  Step 1: MyBatis Mapper
--------------------------------------------------------------------------------

  <!-- ApiSyncLogMapper.xml -->

  <insert id="insertSyncLog" useGeneratedKeys="true" keyProperty="syncId">
    INSERT INTO fscps.bs_api_sync_log (
      target_table, target_id, interface_id, api_method,
      request_body, sync_status, created_by
    ) VALUES (
      #{targetTable}, #{targetId}, #{interfaceId}, #{apiMethod},
      #{requestBody}::jsonb, 'PENDING', #{createdBy}
    )
  </insert>

  <update id="updateSyncResult">
    UPDATE fscps.bs_api_sync_log SET
      response_code = #{responseCode},
      response_body = #{responseBody}::jsonb,
      error_message = #{errorMessage},
      sync_status = #{syncStatus},
      retry_count = retry_count + 1,
      updated_at = NOW(),
      next_retry_at = CASE
        WHEN #{syncStatus} = 'FAIL'
        THEN NOW() + INTERVAL '5 minutes' * (retry_count + 1)
        ELSE NULL
      END
    WHERE sync_id = #{syncId}
  </update>

  <update id="markAsDead">
    UPDATE fscps.bs_api_sync_log SET
      sync_status = 'DEAD',
      updated_at = NOW()
    WHERE sync_id = #{syncId}
  </update>

  <select id="selectRetryTargets" resultType="ApiSyncLogEntity">
    SELECT *
    FROM fscps.bs_api_sync_log
    WHERE sync_status = 'FAIL'
      AND retry_count < max_retry
      AND (next_retry_at IS NULL OR next_retry_at <= NOW())
    ORDER BY created_at ASC
    LIMIT 50
  </select>

  <select id="selectSyncHistory" resultType="ApiSyncLogEntity">
    SELECT *
    FROM fscps.bs_api_sync_log
    WHERE target_table = #{targetTable}
    <if test="targetId != null">
      AND target_id = #{targetId}
    </if>
    <if test="syncStatus != null">
      AND sync_status = #{syncStatus}
    </if>
    ORDER BY created_at DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>

--------------------------------------------------------------------------------
  Step 2: Service - ë™ê¸°í™” ë¡œê·¸ ê¸°ë¡ + API í˜¸ì¶œ
--------------------------------------------------------------------------------

  @Service
  @RequiredArgsConstructor
  public class ApiSyncLogService {

      private final ApiSyncLogMapper syncLogMapper;
      private final MiddlewareApiManager middlewareApiManager;

      /**
       * ë™ê¸°í™” ë¡œê·¸ ìƒì„± + API í˜¸ì¶œ + ê²°ê³¼ ê¸°ë¡
       */
      public void syncWithLog(String targetTable, String targetId,
              String interfaceId, Object requestBody, String userId) {

          // 1. ë¡œê·¸ ìƒì„± (PENDING)
          ApiSyncLogEntity log = new ApiSyncLogEntity();
          log.setTargetTable(targetTable);
          log.setTargetId(targetId);
          log.setInterfaceId(interfaceId);
          log.setApiMethod(getMethod(interfaceId));
          log.setRequestBody(toJson(requestBody));
          log.setCreatedBy(userId);
          syncLogMapper.insertSyncLog(log);

          // 2. API í˜¸ì¶œ
          callApiAndUpdateLog(log);
      }

      /**
       * API í˜¸ì¶œ + ê²°ê³¼ ì—…ë°ì´íŠ¸ (ìµœì´ˆ í˜¸ì¶œ ë° ì¬ì‹œë„ ê³µìš©)
       */
      private void callApiAndUpdateLog(ApiSyncLogEntity syncLog) {
          try {
              MiddlewareReqDto reqDto =
                  middlewareApiManager.getInterfaceInfo(
                      syncLog.getInterfaceId());
              reqDto.setBody(parseJson(syncLog.getRequestBody()));

              ResponseEntity<?> response =
                  middlewareApiManager.sendRequest(reqDto, responseType);

              String code = getResponseCode(response);

              if ("0200".equals(code)) {
                  syncLog.setResponseCode(code);
                  syncLog.setResponseBody(toJson(response.getBody()));
                  syncLog.setSyncStatus("SUCCESS");
              } else {
                  syncLog.setResponseCode(code);
                  syncLog.setResponseBody(toJson(response.getBody()));
                  syncLog.setSyncStatus("FAIL");
              }

          } catch (Exception e) {
              syncLog.setErrorMessage(truncate(e.getMessage(), 500));
              syncLog.setSyncStatus("FAIL");
          }

          // 3. ê²°ê³¼ ì €ì¥
          syncLogMapper.updateSyncResult(syncLog);

          // 4. ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ í™•ì¸
          if ("FAIL".equals(syncLog.getSyncStatus())
                  && syncLog.getRetryCount() >= syncLog.getMaxRetry()) {
              syncLogMapper.markAsDead(syncLog.getSyncId());
              log.warn("ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ â†’ DEAD ì²˜ë¦¬: syncId={}",
                  syncLog.getSyncId());
          }
      }
  }

--------------------------------------------------------------------------------
  Step 3: ê¸°ì¡´ Service ìˆ˜ì • (AirstarBrandService)
--------------------------------------------------------------------------------

  @Service
  @RequiredArgsConstructor
  public class AirstarBrandService {

      private final AirstarBrandMapper airstarBrandMapper;
      private final ApiSyncLogService apiSyncLogService;

      // ===== 1ë‹¨ê³„: DB ì €ì¥ (íŠ¸ëœì­ì…˜) =====
      @Transactional
      public SaveResult savePartnerBrandsToDb(List<PartnerBrandReqDto> list) {
          // ê¸°ì¡´ê³¼ ë™ì¼ - INSERT/UPDATE
          // (sync_status ì»¬ëŸ¼ ë¶ˆí•„ìš” - ë³„ë„ í…Œì´ë¸”ì—ì„œ ê´€ë¦¬)
          ...
          return new SaveResult(regList, upList);
      }

      // ===== 2ë‹¨ê³„: API í˜¸ì¶œ (íŠ¸ëœì­ì…˜ ë°–) =====
      public void syncToFnbPlatform(SaveResult result, String userId) {

          // ë“±ë¡ (CP204)
          if (!result.getRegList().isEmpty()) {
              for (PartnerBrandApiRegReqDto dto : result.getRegList()) {
                  apiSyncLogService.syncWithLog(
                      "bs_airstar_brand",    // ëŒ€ìƒ í…Œì´ë¸”
                      dto.getSteId(),        // ëŒ€ìƒ PK
                      "CP204",               // ì¸í„°í˜ì´ìŠ¤ ID
                      Map.of("brands", List.of(dto)),
                      userId
                  );
              }
          }

          // ìˆ˜ì • (CP206)
          if (!result.getUpList().isEmpty()) {
              for (PartnerBrandApiRegReqDto dto : result.getUpList()) {
                  apiSyncLogService.syncWithLog(
                      "bs_airstar_brand",
                      dto.getSteId(),
                      "CP206",
                      Map.of("brands", List.of(dto)),
                      userId
                  );
              }
          }
      }
  }

--------------------------------------------------------------------------------
  Step 4: ìŠ¤ì¼€ì¤„ëŸ¬ (ìë™ ì¬ì‹œë„)
--------------------------------------------------------------------------------

  @Component
  @RequiredArgsConstructor
  public class ApiSyncRetryScheduler {

      private final ApiSyncLogMapper syncLogMapper;
      private final ApiSyncLogService apiSyncLogService;

      @Scheduled(fixedDelay = 300000)  // 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
      public void retryFailedSync() {

          List<ApiSyncLogEntity> retryList =
              syncLogMapper.selectRetryTargets();

          if (retryList.isEmpty()) return;

          log.info("ìë™ ì¬ì‹œë„ ì‹œì‘: {}ê±´", retryList.size());

          int successCount = 0;
          for (ApiSyncLogEntity syncLog : retryList) {
              try {
                  apiSyncLogService.callApiAndUpdateLog(syncLog);
                  if ("SUCCESS".equals(syncLog.getSyncStatus())) {
                      successCount++;
                  }
              } catch (Exception e) {
                  log.error("ìë™ ì¬ì‹œë„ ì˜ˆì™¸: syncId={}",
                      syncLog.getSyncId(), e);
              }
          }

          log.info("ìë™ ì¬ì‹œë„ ì™„ë£Œ: ì„±ê³µ {}ê±´ / ì „ì²´ {}ê±´",
              successCount, retryList.size());
      }
  }

  â€» next_retry_atì„ ì‚¬ìš©í•œ ì ì§„ì  ë°±ì˜¤í”„:
    1íšŒì°¨ ì‹¤íŒ¨: 5ë¶„ í›„ ì¬ì‹œë„
    2íšŒì°¨ ì‹¤íŒ¨: 10ë¶„ í›„ ì¬ì‹œë„
    3íšŒì°¨ ì‹¤íŒ¨: DEAD ì²˜ë¦¬ (ê´€ë¦¬ì í™•ì¸ í•„ìš”)

--------------------------------------------------------------------------------
  Step 5: ê´€ë¦¬ í™”ë©´ (ë™ê¸°í™” ì´ë ¥ ì¡°íšŒ)
--------------------------------------------------------------------------------

  ë³„ë„ "ë™ê¸°í™” ê´€ë¦¬" í™”ë©´ ë˜ëŠ” ê¸°ì¡´ í™”ë©´ì— íƒ­ ì¶”ê°€:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ë™ê¸°í™” ì´ë ¥ ì¡°íšŒ                               [ì¬ì‹œë„] [ì¡°íšŒ]â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ìƒíƒœ: [ì „ì²´ â–¼]  ì¸í„°í˜ì´ìŠ¤: [ì „ì²´ â–¼]  ê¸°ê°„: [____] ~ [____]â”‚
  â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ No â”‚ ìƒíƒœ â”‚ IF â”‚ëŒ€ìƒIDâ”‚ì‘ë‹µCDâ”‚ì¬ì‹œë„â”‚ìƒì„±ì¼â”‚ìˆ˜ì •ì¼â”‚ì—ëŸ¬ë©”ì‹œì§€   â”‚
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 1  â”‚ âŒ   â”‚CP204â”‚STE001â”‚ 0500 â”‚ 2/3  â”‚2/13â”‚2/13â”‚Connection..â”‚
  â”‚ 2  â”‚ âœ…   â”‚CP206â”‚STE002â”‚ 0200 â”‚ 1/3  â”‚2/13â”‚2/13â”‚            â”‚
  â”‚ 3  â”‚ ğŸ’€   â”‚CP204â”‚STE003â”‚ 0500 â”‚ 3/3  â”‚2/12â”‚2/13â”‚Timeout     â”‚
  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ê¸°ëŠ¥:
  - FAIL ê±´ ì„ íƒ â†’ "ì¬ì‹œë„" ë²„íŠ¼ â†’ ì„ íƒ ê±´ ìˆ˜ë™ ì¬ì²˜ë¦¬
  - DEAD ê±´ â†’ ê´€ë¦¬ìê°€ ì›ì¸ í™•ì¸ í›„ ìˆ˜ë™ ì¡°ì¹˜
  - ìƒíƒœë³„ í•„í„°ë§, ê¸°ê°„ ê²€ìƒ‰

================================================================================
  4. ì¥ë‹¨ì 
================================================================================

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ì¥ì                                                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  âœ… ë¹„ì¦ˆë‹ˆìŠ¤ í…Œì´ë¸” ë³€ê²½ ì—†ìŒ (ê´€ì‹¬ì‚¬ ë¶„ë¦¬)                â”‚
  â”‚  âœ… ëª¨ë“  API í˜¸ì¶œ ì´ë ¥ ìƒì„¸ ì¶”ì  (ìš”ì²­/ì‘ë‹µ ë³¸ë¬¸ê¹Œì§€)      â”‚
  â”‚  âœ… ì–¸ì œ, ì™œ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì •í™•íˆ í™•ì¸ ê°€ëŠ¥                   â”‚
  â”‚  âœ… ìë™ ì¬ì‹œë„ + ìµœëŒ€ íšŸìˆ˜ ê´€ë¦¬ + ì ì§„ì  ë°±ì˜¤í”„           â”‚
  â”‚  âœ… í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ ëª¨ë“  API ì—°ë™ì„ í†µí•© ê´€ë¦¬              â”‚
  â”‚  âœ… DEAD ì²˜ë¦¬ë¡œ ë¬´í•œ ì¬ì‹œë„ ë°©ì§€                            â”‚
  â”‚  âœ… Kafka/Redis ì—†ì´ ìˆœìˆ˜ RDB + ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ êµ¬í˜„ ê°€ëŠ¥       â”‚
  â”‚  âœ… í–¥í›„ í™•ì¥ ìš©ì´ (ì•Œë¦¼ ë°œì†¡, ëŒ€ì‹œë³´ë“œ ë“±)                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ë‹¨ì                                                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  âŒ ì´ˆê¸° ê°œë°œëŸ‰ ë§ìŒ (í…Œì´ë¸”+Mapper+Service+ìŠ¤ì¼€ì¤„ëŸ¬+í™”ë©´) â”‚
  â”‚  âŒ ë™ê¸°í™” ê´€ë¦¬ í™”ë©´ ë³„ë„ ê°œë°œ í•„ìš”                        â”‚
  â”‚  âŒ ìš”ì²­/ì‘ë‹µ ë³¸ë¬¸ ì €ì¥ìœ¼ë¡œ ë°ì´í„° ìš©ëŸ‰ ì¦ê°€               â”‚
  â”‚  âŒ ë””ë²„ê¹… ì‹œ sync_log í…Œì´ë¸”ë„ í•¨ê»˜ í™•ì¸í•´ì•¼ í•¨           â”‚
  â”‚  âŒ ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë¦¬ (ì„œë²„ ì¬ì‹œì‘ ì‹œ ë™ì‘ í™•ì¸ ë“±)            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
  5. ì‹¤íŒ¨ ì‹œ íë¦„
================================================================================

  ì‚¬ìš©ì: ì €ì¥ í´ë¦­
       â†“
  [DB INSERT/UPDATE + ì»¤ë°‹ ì™„ë£Œ]
       â†“
  [sync_log INSERT (PENDING)]
       â†“
  [API í˜¸ì¶œ]
       â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ì„±ê³µ    â”‚ sync_log â†’ SUCCESS (ì‘ë‹µ ì½”ë“œ, ë³¸ë¬¸ ê¸°ë¡)       â”‚
  â”‚         â”‚ â†’ ì™„ë£Œ                                          â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ì‹¤íŒ¨    â”‚ sync_log â†’ FAIL (ì—ëŸ¬ ë©”ì‹œì§€, retry_count++)    â”‚
  â”‚         â”‚ â†’ next_retry_at = 5ë¶„ í›„                        â”‚
  â”‚         â”‚                                                  â”‚
  â”‚ 5ë¶„ í›„  â”‚ [ìŠ¤ì¼€ì¤„ëŸ¬] FAIL ê±´ ìë™ ì¬ì‹œë„                  â”‚
  â”‚         â”‚ â†’ ì„±ê³µ â†’ SUCCESS âœ…                              â”‚
  â”‚         â”‚ â†’ ì‹¤íŒ¨ â†’ FAIL (retry_count++)                   â”‚
  â”‚         â”‚                                                  â”‚
  â”‚ 10ë¶„ í›„ â”‚ [ìŠ¤ì¼€ì¤„ëŸ¬] 2ì°¨ ì¬ì‹œë„                            â”‚
  â”‚         â”‚ â†’ ì„±ê³µ â†’ SUCCESS âœ…                              â”‚
  â”‚         â”‚ â†’ ì‹¤íŒ¨ â†’ FAIL (retry_count = 3)                 â”‚
  â”‚         â”‚                                                  â”‚
  â”‚ ì´ˆê³¼ ì‹œ â”‚ retry_count >= max_retry                        â”‚
  â”‚         â”‚ â†’ sync_log â†’ DEAD ğŸ’€                            â”‚
  â”‚         â”‚ â†’ ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼ (ì„ íƒì‚¬í•­)                    â”‚
  â”‚         â”‚ â†’ ê´€ë¦¬ í™”ë©´ì—ì„œ ìˆ˜ë™ í™•ì¸ ë° ì¡°ì¹˜               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
  6. ì‹œë‚˜ë¦¬ì˜¤ 2 (ì»¬ëŸ¼ ì¶”ê°€) vs ì‹œë‚˜ë¦¬ì˜¤ 3 (í…Œì´ë¸” ì¶”ê°€) ë¹„êµ
================================================================================

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  í•­ëª©           â”‚ ì‹œë‚˜ë¦¬ì˜¤ 2 (ì»¬ëŸ¼)    â”‚ ì‹œë‚˜ë¦¬ì˜¤ 3 (í…Œì´ë¸”)   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  ìŠ¤í‚¤ë§ˆ ë³€ê²½    â”‚ ALTER TABLE 1ì¤„      â”‚ CREATE TABLE 1ê°œ      â”‚
  â”‚  ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥  â”‚ ì»¬ëŸ¼ 1ê°œ ì¶”ê°€        â”‚ ë³€ê²½ ì—†ìŒ             â”‚
  â”‚  ì‹¤íŒ¨ ì´ë ¥      â”‚ ìµœì¢… ìƒíƒœë§Œ (1ê±´)    â”‚ ì „ì²´ ì´ë ¥ (Nê±´)       â”‚
  â”‚  ì—ëŸ¬ ì›ì¸ ì¶”ì  â”‚ ì„œë²„ ë¡œê·¸ í™•ì¸       â”‚ í…Œì´ë¸”ì—ì„œ ì§ì ‘ í™•ì¸  â”‚
  â”‚  ìš”ì²­/ì‘ë‹µ ë³´ê´€ â”‚ âŒ ì—†ìŒ              â”‚ âœ… JSONìœ¼ë¡œ ë³´ê´€      â”‚
  â”‚  ì¬ì‹œë„ ë°©ì‹    â”‚ ìˆ˜ë™ ë²„íŠ¼            â”‚ ìë™ + ìˆ˜ë™           â”‚
  â”‚  ì¬ì‹œë„ íšŸìˆ˜    â”‚ ê´€ë¦¬ ì•ˆ í•¨           â”‚ retry_countë¡œ ê´€ë¦¬    â”‚
  â”‚  ë°±ì˜¤í”„         â”‚ âŒ ì—†ìŒ              â”‚ âœ… ì ì§„ì  ê°„ê²© ì¦ê°€   â”‚
  â”‚  DEAD ì²˜ë¦¬      â”‚ âŒ ì—†ìŒ              â”‚ âœ… 3íšŒ ì´ˆê³¼ ì‹œ DEAD   â”‚
  â”‚  ê´€ë¦¬ í™”ë©´      â”‚ ê¸°ì¡´ í™”ë©´ì— ì»¬ëŸ¼ ì¶”ê°€â”‚ ë³„ë„ ê´€ë¦¬ í™”ë©´        â”‚
  â”‚  ê°œë°œ ê¸°ê°„      â”‚ APIë‹¹ ë°˜ë‚˜ì ˆ         â”‚ ì´ˆê¸° 2~3ì¼ + APIë‹¹ 2h â”‚
  â”‚  ì¬ì‚¬ìš©ì„±       â”‚ í…Œì´ë¸”ë§ˆë‹¤ ì»¬ëŸ¼ ì¶”ê°€ â”‚ 1ê°œ í…Œì´ë¸”ë¡œ í†µí•©     â”‚
  â”‚  ì í•©í•œ ê·œëª¨    â”‚ API 5ê°œ ì´í•˜         â”‚ API 10ê°œ ì´ìƒ         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â€» í˜„ì¬ í”„ë¡œì íŠ¸ ê¸°ì¤€ (3ê°œì›”, API 6ê°œ: CP201~CP206):
    ì‹œë‚˜ë¦¬ì˜¤ 2ê°€ ë” í˜„ì‹¤ì .
    ë‹¤ë§Œ, í–¥í›„ API ì—°ë™ì´ ëŠ˜ì–´ë‚  ì˜ˆì •ì´ë©´ ì‹œë‚˜ë¦¬ì˜¤ 3 ê³ ë ¤.

================================================================================
  7. ì‘ì—… ë²”ìœ„
================================================================================

  ì´ˆê¸° êµ¬ì¶• (1íšŒ):
  | ì‘ì—…                              | ì˜ˆìƒ ì‹œê°„ |
  |-----------------------------------|-----------|
  | CREATE TABLE + ì¸ë±ìŠ¤             | 30ë¶„      |
  | Mapper XML ì‘ì„±                   | 1ì‹œê°„     |
  | ApiSyncLogService êµ¬í˜„            | 3ì‹œê°„     |
  | ApiSyncRetryScheduler êµ¬í˜„        | 2ì‹œê°„     |
  | ë™ê¸°í™” ê´€ë¦¬ í™”ë©´ (í”„ë¡ íŠ¸)         | 1ì¼       |
  |-----------------------------------|-----------|
  | ì´ˆê¸° êµ¬ì¶• í•©ê³„                    | ì•½ 2~3ì¼  |

  ê° API ì—°ë™ ì ìš© (APIë‹¹):
  | ì‘ì—…                              | ì˜ˆìƒ ì‹œê°„ |
  |-----------------------------------|-----------|
  | ê¸°ì¡´ Serviceì— syncWithLog ì—°ë™   | 2ì‹œê°„     |
  |-----------------------------------|-----------|

  â€» ì´ˆê¸° êµ¬ì¶• ë¹„ìš©ì´ ìˆì§€ë§Œ, ì´í›„ API ì¶”ê°€ ì‹œ ì—°ë™ì´ ë§¤ìš° ê°„ë‹¨
  â€» í•˜ë‚˜ì˜ í…Œì´ë¸”ë¡œ CP204, CP206 ë“± ëª¨ë“  APIë¥¼ í†µí•© ê´€ë¦¬

================================================================================
  8. ì´ ë°©ì‹ì´ ì í•©í•œ ìƒí™©
================================================================================

  âœ… ì í•©:
  - ì™¸ë¶€ API ì—°ë™ì´ 10ê°œ ì´ìƒìœ¼ë¡œ ë§ì€ í”„ë¡œì íŠ¸
  - ì¥ì•  ë°œìƒ ì‹œ ì •í™•í•œ ì›ì¸ íŒŒì•…ì´ í•„ìš”í•œ ìš´ì˜ í™˜ê²½
  - ìë™ ì¬ì‹œë„ + ìµœëŒ€ íšŸìˆ˜ ê´€ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°
  - ê°ì‚¬ ë¡œê·¸(audit trail)ê°€ í•„ìš”í•œ ê²½ìš°
  - ì¥ê¸° ìš´ì˜ í”„ë¡œì íŠ¸ (1ë…„ ì´ìƒ)

  âŒ ë¶€ì í•©:
  - 3ê°œì›” ë‹¨ê¸° í”„ë¡œì íŠ¸ì—ì„œ ì´ˆê¸° êµ¬ì¶• ë¹„ìš©ì´ ë¶€ë‹´ì¸ ê²½ìš°
  - ì™¸ë¶€ API ì—°ë™ì´ 5ê°œ ì´í•˜ë¡œ ì ì€ ê²½ìš°
  - ìš´ì˜íŒ€ì´ ë³„ë„ ê´€ë¦¬ í™”ë©´ì„ ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš°
  - ë¹ ë¥¸ êµ¬í˜„ì´ ìš°ì„ ì¸ ê²½ìš° (â†’ ì‹œë‚˜ë¦¬ì˜¤ 2 ì¶”ì²œ)
