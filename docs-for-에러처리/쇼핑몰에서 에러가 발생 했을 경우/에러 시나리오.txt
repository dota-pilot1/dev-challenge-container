=====================================
쇼핑몰에서 에러가 발생했을 경우 — 시나리오별 처리
=====================================

■ 시나리오 1: 재고 부족

  사용자 동작: 승인 버튼 클릭
  발생 위치: shop-api OrderService.create()
  에러: BadRequestException("재고가 부족합니다")

  처리 흐름:
    shop-api → HttpExceptionFilter → { code: "PAYMENT_400", message: "재고 부족" }
    Spring Boot → ShopClient에서 RestClientException 캐치
    → 참가 상태: APPROVE_FAILED
    → 이력: FAILED + "재고가 부족합니다 (현재: 0개 / 주문: 50개)"
    프론트 → ConfirmDialog로 에러 상세 표시

  관리자 대응: 재고 추가 후 재시도


■ 시나리오 2: 상품 없음

  사용자 동작: 승인 버튼 클릭
  발생 위치: shop-api OrderService.create()
  에러: NotFoundException("상품 ID 99를 찾을 수 없습니다")

  처리 흐름:
    shop-api → HttpExceptionFilter → { code: "PAYMENT_404", message: "상품 없음" }
    Spring Boot → APPROVE_FAILED + 이력(FAILED) 저장
    프론트 → ConfirmDialog로 표시

  관리자 대응: 챌린지의 보상 상품 설정 확인


■ 시나리오 3: shop-api 서버 다운

  사용자 동작: 승인 버튼 클릭
  발생 위치: ShopClient.createOrder()
  에러: RestClientException (연결 실패)

  처리 흐름:
    Spring Boot → ShopClient에서 Exception 캐치
    → 참가 상태: APPROVE_FAILED
    → 이력: FAILED + "Connection refused"
    프론트 → ConfirmDialog로 에러 표시

  관리자 대응: shop-api 서버 상태 확인 후 재시도


■ 시나리오 4: 인증 실패

  사용자 동작: 로그인
  발생 위치: Spring Boot AuthService
  에러: BadCredentialsException

  처리 흐름:
    Spring Boot → GlobalExceptionHandler
    → { code: "AUTH_401", message: "이메일 또는 비밀번호가 잘못되었습니다" }
    프론트 → toast.error로 표시

  사용자 대응: 이메일/비밀번호 확인


■ 시나리오 5: 유효성 검증 실패

  사용자 동작: 챌린지 생성 (필수 필드 누락)
  발생 위치: Spring Boot Controller
  에러: MethodArgumentNotValidException

  처리 흐름:
    Spring Boot → GlobalExceptionHandler
    → 필드별 에러 메시지 매핑
    → { code: "COMMON_400", message: "제목은 필수입니다" }
    프론트 → toast.error로 표시

  사용자 대응: 필수 입력값 확인


■ 시나리오 6: 중복 승인 시도

  사용자 동작: 이미 승인된 참가에 다시 승인 요청
  발생 위치: ParticipationService.approve()
  에러: CustomException("제출 완료 상태에서만 승인할 수 있습니다")

  처리 흐름:
    Spring Boot → GlobalExceptionHandler
    → { code: "COMMON_400", message: "제출 완료 상태에서만 승인할 수 있습니다" }
    프론트 → toast.error로 표시

  원인: 비관적 락에 의해 먼저 승인된 경우


■ 시나리오 7: 후속 처리 실패 (보상 트랜잭션)

  사용자 동작: 승인 → 주문 성공 → 내부 DB 업데이트 실패
  발생 위치: ParticipationService.approve() 내부 try-catch
  에러: SQLException (내부 DB)

  처리 흐름:
    Spring Boot → 보상 트랜잭션 실행 (shopClient.cancelOrder)
    → 주문 취소 + 재고 복구
    → 참가 상태: APPROVE_FAILED
    → 이력: FAILED + "주문 생성 후 후속 처리 실패 (보상 트랜잭션 실행됨)"
    프론트 → ConfirmDialog로 에러 표시

  관리자 대응: DB 상태 확인 후 재시도


■ 에러 유형별 표시 방식

  | 에러 유형           | 표시 방식        | 예시                          |
  | 간단한 에러         | toast.error     | 로그인 실패, 유효성 검증       |
  | 승인 실패 (상세)    | ConfirmDialog   | 재고 부족, 서버 다운           |
  | 성공                | toast.success   | 재고 수정, 승인 완료           |
