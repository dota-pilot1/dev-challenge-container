================================================================================
  주문/승인 성공 실패에 대한 테이블 추가 및 로직 수정 요약
================================================================================


[왜 이력 테이블이 필요한가]

  - 승인(DB 저장)은 @Transactional로 보장됨 → 실패하면 롤백
  - 진짜 추적이 필요한 건 외부 주문(shop-api 호출)의 성공/실패
  - 기존에는 주문 실패해도 APPROVED로 저장 → 실패 여부를 알 수 없었음


[추가된 테이블]

  approval_history
  ┌──────────────────┬──────────────┬──────────────────────────────┐
  │ 컬럼             │ 타입         │ 설명                         │
  ├──────────────────┼──────────────┼──────────────────────────────┤
  │ id               │ BIGSERIAL PK │ 이력 ID                      │
  │ participation_id │ BIGINT FK    │ 참가 ID                      │
  │ action           │ VARCHAR(30)  │ 시도 유형 (요청의 주목적)    │
  │ status           │ VARCHAR(20)  │ 주문 결과 (SUCCESS / FAILED) │
  │ order_id         │ INTEGER      │ 성공 시 주문 ID (조회용)     │
  │ error_message    │ TEXT         │ 실패 사유                    │
  │ created_at       │ TIMESTAMP    │ 시도 시각                    │
  └──────────────────┴──────────────┴──────────────────────────────┘

  각 컬럼의 역할:
    - status: 주문 성공 여부만 추적 (DB 저장은 트랜잭션이 보장)
    - action: 이 시도가 최초 요청인지, 재시도인지, 취소인지 구분
    - order_id: 성공 시 저장 → shop-api에서 주문 상세 조회 가능


[변경된 로직]

  approve() 변경 전:
    주문 성공 → APPROVED + order_id 저장
    주문 실패 → APPROVED + order_id = NULL (문제!)

  approve() 변경 후:
    주문 성공 → APPROVED + order_id 저장 + 이력 INSERT (SUCCESS)
    주문 실패 → APPROVE_FAILED + 이력 INSERT (FAILED + errorMessage)

  추가된 상태:
    기존: APPLIED → SUBMITTED → APPROVED / REJECTED
    변경: APPLIED → SUBMITTED → APPROVED / APPROVE_FAILED / REJECTED


[추가된 API]

  PATCH /api/participations/{id}/retry-approve
    - APPROVE_FAILED 상태에서 재시도
    - 성공 → APPROVED + 이력 (APPROVE_RETRY, SUCCESS)
    - 실패 → APPROVE_FAILED 유지 + 이력 (APPROVE_RETRY, FAILED)

  GET /api/approval-history
    - 전체 이력 조회

  GET /api/participations/{id}/approval-history
    - 특정 참가자의 이력 조회


[수정/생성된 파일]

  신규:
    - V4__create_approval_history_table.sql (마이그레이션)
    - ApprovalHistory.java (엔티티)
    - ApprovalHistoryMapper.java + .xml (매퍼)
    - ApprovalHistoryController.java (전체 이력 조회)
    - approval-history.tsx (이력 관리 페이지)

  수정:
    - ParticipationService.java (approve 수정 + retryApprove 추가)
    - ParticipationController.java (retry-approve + 이력 조회 엔드포인트)
    - participation-api.ts (retryApprove API)
    - challenges.tsx (APPROVE_FAILED 뱃지 + 재시도 버튼)
    - layout.tsx (헤더: Concurrency Test → 이력 관리)

================================================================================
