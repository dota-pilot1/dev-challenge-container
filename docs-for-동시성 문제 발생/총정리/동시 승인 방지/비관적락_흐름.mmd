sequenceDiagram
    participant A as 요청 A
    participant DB as PostgreSQL
    participant B as 요청 B

    Note over A,B: 같은 챌린지 참가(id=3)에 동시 승인 요청

    A->>DB: SELECT ... WHERE id=3 FOR UPDATE
    activate DB
    DB-->>A: 잠금 획득 + 상태: SUBMITTED

    B->>DB: SELECT ... WHERE id=3 FOR UPDATE
    Note right of B: 잠금 대기 (A가 끝날 때까지 블로킹)

    A->>DB: UPDATE status = 'APPROVED'
    Note left of A: A가 상태를 SUBMITTED → APPROVED로 변경

    A->>DB: COMMIT
    deactivate DB
    Note over DB: 잠금 해제 → B가 이제서야 읽기 가능

    activate DB
    DB-->>B: 잠금 획득 + 상태: APPROVED (이미 A가 변경한 값)
    deactivate DB

    Note right of B: status != SUBMITTED 이므로 승인 불가
    B--xB: "제출 완료 상태에서만 승인 가능" → 거부
