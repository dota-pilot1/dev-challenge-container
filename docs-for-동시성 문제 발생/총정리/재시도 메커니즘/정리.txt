## 재시도 메커니즘 — 승인 실패 시 재시도

### 문제
챌린지 승인 시 shop-api 주문 생성이 실패할 수 있다.
(재고 부족, 네트워크 오류, shop-api 장애 등)

실패하면 참가 상태가 APPROVE_FAILED가 되는데,
관리자가 문제를 해결한 후 다시 시도할 수 있어야 한다.


### 구현 구조

상태 흐름:
  SUBMITTED → (승인 시도) → APPROVED (성공)
                          → APPROVE_FAILED (실패)

  APPROVE_FAILED → (재시도) → APPROVED (성공)
                            → APPROVE_FAILED (다시 실패)


### 백엔드 — retryApprove()

  @Transactional
  public Participation retryApprove(Long id) {
      // 1. 비관적 락으로 참가 조회
      Participation p = participationMapper.findByIdForUpdate(id);

      // 2. APPROVE_FAILED 상태에서만 재시도 가능
      if (!"APPROVE_FAILED".equals(p.getStatus())) {
          throw new CustomException("승인 실패 상태에서만 재시도할 수 있습니다");
      }

      // 3. shop-api에 주문 요청 (approve와 동일한 로직)
      shopClient.createOrder(...);

      // 4. 성공 시 APPROVED, 실패 시 APPROVE_FAILED 유지
  }


### 프론트엔드 — 재시도 버튼

참가자 카드에서 APPROVE_FAILED 상태일 때:
  - "재시도" 버튼: 1번 요청
  - "더블 재시도" 버튼: 동시에 2번 요청 (멱등성 키 테스트용)

실패 시: ConfirmDialog로 에러 상세 내용 표시
  - approval_history에서 최신 FAILED 이력을 조회
  - JSON 에러 메시지를 파싱해서 읽기 쉽게 변환
  - "재고가 부족합니다 (현재: 0개 / 주문: 50개 / 부족: 50개)" 같은 형태

성공 시: toast.success로 간단히 알림


### 이력 기록
모든 승인 시도는 approval_history 테이블에 기록됨:
  - action: APPROVE_REQUEST (최초) / APPROVE_RETRY (재시도)
  - status: SUCCESS / FAILED
  - error_message: 실패 사유
  - order_id: 성공 시 생성된 주문 ID


### 적용 위치
- concurrency-lab/.../service/ParticipationService.java — retryApprove()
- devquest-web/src/routes/challenges.tsx — 재시도/더블 재시도 버튼
- devquest-web/src/shared/ui/confirm-dialog.tsx — 에러 상세 다이얼로그
- devquest-web/src/shared/lib/parse-error-message.ts — JSON 에러 파싱
